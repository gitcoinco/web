{% comment %}
  Copyright (C) 2020 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% load static humanize i18n grants_extra %}

<div class="px-0 pr-md-3 my-0 mx-0 mt-md-5 mr-md-5">
  {% if not grant.twitter_verified %}
  <div class="my-0 mx-0">
    <div class="verification__warning pt-0 pb-0 pr-2 pl-2 d-flex">
      <i class="fas fa-exclamation-triangle verification__warning__icon mr-2"></i>
      <div>
        <div class="uppercase">
          Warning: This grant has not verified their ownership of the twitter account listed.
        </div>
        {% if is_team_member %}
        <div class="text-right mt-3">
          <button class="btn btn-sm btn-gc-blue" data-toggle="modal" data-target="#startVerification">Verify your grant</button>
          <br>
          or <a href="https://github.com/gitcoinco/web/issues/new/">Submit a support request</a>.
        {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <div id="funding-card" class="card my-0 mx-0 mt-md-5 mr-md-5 shadow-sm">
    <div class="card-body">
      <div class="row progress-container  {% if clr_active %} mb-2 {% endif %} {% if not is_team_member %} mt-4 {% endif %}">
        {% if grant.is_clr_eligible and round_num %}
          <div class="col-6 text-center text-xl-left offset-xl-0 col-xl-6 mb-xl-0 ">
            {% include 'grants/card/clr_match.html' %}
          </div>
        {% endif %}

        <div class="col-6 text-center text-xl-left offset-xl-0 col-xl-6">
          <p class="sub-title mb-1 font-weight-semibold font-caption mb-1 pt-1">
            ALL TIME FUNDING
          </p>
          <h2 class="font-title font-weight-bold amount pt-1 mb-0">
            {{grant.amount_received|floatformat:0|intcomma}} DAI
          </h2>
          <p class="mb-2 font-caption">
            {{grant.contributor_count}} CONTRIBUTORS
          </p>
        </div>
      </div>

      {% if grant.is_clr_eligible and clr_active and grant.active %}
        {% include 'grants/card/clr_estimate.html' %}
      {% endif %}

      {% if not grant.active %}
        <button type="button" class="mt-3 button button--primary shadow-none font-weight-bold button--full py-3" disabled>
          {% trans "Grant Has Ended" %}
        </button>


      {% elif is_team_member %}
        <button class="mt-3 btn btn-gc-grey cart-btn large font-body font-weight-semibold mt-1 mr-1">
          <i class="fa fa-stop" aria-hidden="true"></i> Cannot Fund your Own Grant
        </button>

      {% elif not is_team_member %}
        <div class="pt-2 mb-1 d-flex justify-content-between">
          {% is_favorite grant profile.user as is_grant_favorite %}
          {% if profile.user.is_authenticated %}
            <button class="text-decoration-none btn btn-link following-action m-0 p-0 mr-4 gc-text-blue {% if not is_grant_favorite %}text-muted{% endif %}" data-grant="{{ grant.id }}">
                {% if not is_grant_favorite %}
                  <i class="far fa-star" ></i><span class="ml-1 font-body">Follow</span>
                {% else %}
                  <i class="fa fa-star" ></i><span class="ml-1 font-body">Following</span>
                {% endif %}
            </button>
          {% endif %}
        </div>

        {% if user_non_errored_subscription %}
          <a href="{% url 'grants:subscription_cancel' grant.id grant.slug user_subscription.id %}">
            <button class="mt-3 button button--primary button--warning button--full shadow-none font-weight-bold py-3">
              {% trans "Cancel Your Funding" %}
            </button>
          </a>
        {% elif grant.link_to_new_grant %}
          <a href="{{ grant.link_to_new_grant.url }}">
            <button class="mt-3 button button--primary shadow-none font-weight-bold button--full py-3">
              Visit the active grant to fund
            </button>
          </a>
        {% else %}
          <form id="js-addToCart-form" class="mt-3">
            {% include 'grants/shared/hidden_inputs.html' %}
            <button class="btn btn-gc-blue button--full shadow-none font-weight-bold py-3" id='js-addToCart-button'>
              ADD TO CART
            </button>
          </form>
          <div class="text-center">
          </div>
        {% endif %}
      {% endif %}

      {% if not is_team_member %}
        <div class="pt-2 mb-1">
          <div class="text-right">
            <a id="flag" href="#" data-href="/grants/flag/{{grant.id}}" class="font-caption font-weight-semibold px-3">
              Flag <i class="ml-2 far fa-flag"></i>
            </a>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
