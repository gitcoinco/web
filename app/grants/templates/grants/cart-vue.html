{% comment %}
Copyright (C) 2020 Gitcoin Core

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>. {% endcomment %} {% load static i18n %} <!DOCTYPE
  html>
  <html lang="en">

  <head>
    {% include 'shared/head.html' with slim=1 %}
    {% include 'shared/cards_pic.html' %}
    <link rel="stylesheet" href="{% static "v2/css/bounty.css" %}">
    <link rel="stylesheet" href="{% static "v2/css/grants/detail.css" %}">
    <link rel="stylesheet" href="{% static "v2/css/grants/fund.css" %}">
    <link rel="stylesheet" href={% static "v2/css/tabs.css" %}>
    <link rel="stylesheet" href={% static "v2/css/dashboard.css" %}>
    <link rel="stylesheet" href={% static "v2/css/tag.css" %}>
    <link rel="stylesheet" href="{% static "v2/css/grants/profile.css" %}">
    <link rel="stylesheet" href="{% static "v2/css/town_square.css" %}">
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.bubble.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static "v2/css/grants/cart.css" %}">
  </head>

  <body class="interior {{ active }} grant grant-detail g-font-muli">
    {% include 'shared/tag_manager_2.html' %}
    <div class="container-fluid header dash">
      {% include 'shared/top_nav.html' with class='d-md-flex' %}
      {% include 'grants/nav.html' %}
    </div>

    {% include 'grants/shared/waiting_state.html' %}

    <div>
      <div id="gc-grants-cart" v-cloak>
        <grants-cart ref="cart" inline-template>
          <div>

            <a id="cart_backgrants" class="font-caption ml-2" href="/grants">
              <i class="fas fa-chevron-left mr-1"></i>
              Back to Grants
            </a>

            {% comment %} Heading section {% endcomment %}
            <div class="container" style="margin:3rem auto 1rem;">
              <div class="row align-items-center justify-content-between">
                <div class="col-auto" style="margin:0 auto">
                  <img src="{% static 'v2/images/grants/triangles.png' %}" alt="Triangles" width="150">
                </div>
              </div>

              <div class="row align-items-end justify-content-between" style="margin-top:2rem; width:100%">
                <h1 class="col-auto text-left font-bigger-2 black" style="font-weight: bold; margin-bottom: 0">
                  GRANT CART ([[ grantData.length ]] ITEM<span v-if="grantData.length !== 1">S</span>)
                </h1>
                <div class="col-auto text-right font-smaller-1 hyperlink"
                  @click="showSMSValidationModal()">
                  Verify my number
                </div>
                <div class="col-auto text-right font-smaller-1 hyperlink" style="margin: 2rem 0 0 auto;"
                  @click="confirmClearCart">
                  Clear cart <i class="fa fa-times" aria-hidden="true"></i>
                </div>
                <div class="col-auto text-right font-smaller-1 hyperlink"
                  @click="shareCart">
                  Share cart <i class="fa fa-share-alt" aria-hidden="true"></i>
                </div>
                <div class="col-auto text-right font-smaller-1 hyperlink"
                     @click="showCreateCollection = true">
                  Save as Collection <i class="fas fa-heart"></i>
                </div>
              </div>
            </div>

            {% comment %} Divider {% endcomment %}
            <div>
              <div class="separator" />
            </div>


            {% comment %} Main container {% endcomment %}
            <div v-if="grantData.length === 0" class="flex-container font-bigger-1 text-left grant-header-row"
              style="justify-content: center; margin: 5rem 0">
              Your cart is empty.
            </div>

            <div v-else-if="isLoading" style="margin:5rem 0">
              <loading-screen></loading-screen>
              <div style="margin:3rem; text-align:center">Fetching cart data...</div>
            </div>

            <div v-else class="container" style="padding-bottom: 10rem;">
              <div v-if="!isBrightIDVerified" class="grant-row-style">
                <div class="row align-items-center justify-content-between">
                  <div class="col col-12 col-md-8 col-lg-9">
                    <strong>Get up to 30% greater CLR Match Amount by improving your Trust Bonus</strong> <br />
                    <font size="2">
                      Increase your CLR Match Amount by verifying your profile, and help Gitcoin be more sybil-resistant.
                      Do this anytime before the end of the grants round to earn the match retroactively for all your contributions.
                    </font>
                  </div>
                  <div class="col col-12 col-md-4 col-lg-3 mt-3 mt-md-0 mx-auto text-center">
                    <a href="/{{ username }}/trust" class="button button--primary text-nowrap" role="button" target="_blank">Improve Trust Bonus</a>
                  </div>
                </div>
              </div>
              {% comment %} Cart header {% endcomment %}
              <div v-if="!isMobileDevice"
                class="row align-items-center justify-content-between font-smaller-2 text-left grant-header-row">
                <div class="col-4">
                  Grant
                </div>
                <div class="col-3">
                  Amount
                </div>
                <div class="col-2">
                  Total CLR Match Amount
                </div>
                <div class="col-1">
                  &nbsp;
                </div>
              </div>
              {% comment %} Cart Contents: MOBILE {% endcomment %}
              <div v-if="isMobileDevice">
                <div v-for="(grant, index) in grantData" :key="grant.grant_id" class="grant-row">
                  <div class="grant-row-style">
                    <div class="row align-items-center justify-content-between">
                      {% comment %} Logo, title, and delete button {% endcomment %}
                      <div class="col-12">
                        <div class="row flex-nowrap">
                          <img class="col-2" style="padding:0 0.5rem" :src="grant.grant_logo" alt="Grant logo"
                            width="40" height="24">
                          <div class="col-8 grant-name black" style="padding:0"><a :href="grant.grant_url">[[grant.grant_title]]</a></div>
                          <div class="col-1" style="opacity: 40%">
                            <i class="fas fa-trash-alt" style="cursor: pointer"
                              @click="removeGrantFromCart(grant.grant_id)"></i>
                          </div>
                        </div>
                      </div>
                      {% comment %} Grant amount and curency {% endcomment %}
                      <div class="col-12" style="margin-top:1rem;">
                        <div class="row flex-nowrap justify-content-between">
                          <input class="col-5 form-control" style="margin-left:0.5rem" min="0" step="any"
                            v-model="grant.grant_donation_amount" type="number" placeholder="Amount">
                          <select2 v-model="grant.grant_donation_currency" class="col-6 form-control"
                            style="margin-right:0.5rem" placeholder="Select token">
                            <option v-for="option in currencies[index]" v-bind:value="option" :disabled="!option">
                              <span v-if="!option" style="height:1px; font-size:1px">&mdash;&mdash;&mdash;&mdash;</span>
                              <span v-else>[[ option ]]</span>
                            </option>
                          </select2>
                        </div>
                        <div class="font-smaller-2 hyperlink" @click="applyAmountToAllGrants(grant, index)">
                          Apply to all
                        </div>
                      </div>
                      {% comment %} Add comment {% endcomment %}
                      <div class="col-12 font-smaller-3" style="margin-top:1rem">
                        <div class="row">
                          <div class="comment-option col-auto" @click="addComment(index)">
                            <input :id="`comment-${index}-blank`" type="radio" class="radio-input" :name="`comment-${index}`"
                                   :checked="grant.grant_comments === ''"
                            >
                            <label :for="`comment-${index}-blank`" class="radio-label">+ Add comment to owner</label>
                          </div>
                          <div class="comment-option col-auto" @click="addComment(index, 'üôå Great Job')">
                            <input :id="`comment-${index}-job`" type="radio" class="radio-input" :name="`comment-${index}`"
                                   :checked="grant.grant_comments === 'üôå Great Job'"
                            >
                            <label :for="`comment-${index}-job`" class="radio-label">üôå Great Job</label>
                          </div>
                          <div class="comment-option col-auto" @click="addComment(index, 'üëç i appreciate you')">
                            <input :id="`comment-${index}-appreciate`" type="radio" class="radio-input" :name="`comment-${index}`"
                                   :checked="grant.grant_comments === 'üëç i appreciate you'"
                            >
                            <label :for="`comment-${index}-appreciate`" class="radio-label">üëç i appreciate you</label>
                          </div>
                          <div class="comment-option col-auto" @click="addComment(index, 'üí™ keep up the great work')">
                            <input :id="`comment-${index}-work`" type="radio" class="radio-input" :name="`comment-${index}`"
                                   :checked="grant.grant_comments === 'üí™ keep up the great work'"
                            >
                            <label :for="`comment-${index}-work`" class="radio-label">üí™ keep up the great work</label>
                          </div>
                          <div class="comment-option col-auto" @click="addComment(index, 'üòç love the mission of your project')">
                            <input :id="`comment-${index}-love`" type="radio" class="radio-input" :name="`comment-${index}`"
                                   :checked="grant.grant_comments === 'üòç love the mission of your project'"
                            >
                            <label :for="`comment-${index}-love`" class="radio-label">üòç love the mission of your project</label>
                          </div>
                        </div>
                      </div>
                      <div v-if="grant.grant_comments !== undefined" class="col-12" style="margin-top:1rem;">
                        <div class="row flex-nowrap justify-content-between">
                          <input class="form-control" style="margin-left:0.5rem" v-model="grant.grant_comments"
                            type="textarea" placeholder="Enter message">
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
              {% comment %} Cart Contents: NOT MOBILE {% endcomment %}
              <div v-if="!isMobileDevice" v-for="(grant, index) in grantData" class="grant-row">
                <div class="grant-row-style">
                  <div class="row align-items-center justify-content-between" style="margin-left:0.5rem">
                    {% comment %} Title and logo {% endcomment %}
                    <div class="col-4">
                      <div class="row">
                        <img :src="grant.grant_logo" style="margin-right: 0.5rem" alt="Grant logo" width="30"
                          height="24">
                        <div class="grant-name black"><a :href="grant.grant_url" target="_blank">[[grant.grant_title]]</a></div>
                      </div>
                    </div>
                    {% comment %} Grant amount and currency {% endcomment %}
                    <div class="col-3">
                      <div class="row flex-nowrap align-items-center justify-content-start">
                        <input class="col-6 form-control" v-model="grant.grant_donation_amount" type="number" min="0" step="any"
                          placeholder="Amount" style="margin-right: 1rem">
                        <select2 v-model="grant.grant_donation_currency" class="col-6 form-control"
                          placeholder="Select token">
                          <option v-for="option in currencies[index]" v-bind:value="option" :disabled="!option">
                            <span v-if="!option" style="height:1px; font-size:1px">&mdash;&mdash;&mdash;&mdash;</span>
                            <span v-else>[[ option ]]</span>
                          </option>
                        </select2>
                      </div>
                      <div class="row flex-nowrap align-items-center justify-content-start">
                        <div class="text-left font-smaller-2 hyperlink" @click="applyAmountToAllGrants(grant)">
                          Apply to all
                        </div>
                      </div>
                    </div>
                    {% comment %} CLR Match Amount {% endcomment %}
                    <div class="col-2">
                      <div class="row align-items-center justify-content-between clr-match-box">
                        <template v-if="grant.is_clr_eligible == true">
                          <div>[[grant.grant_donation_clr_match]] DAI</div>
                          <img src="{% static 'v2/images/diamonds_high_fiving.gif' %}" alt="Diamonds high-fiving"
                          width="20">
                        </template>
                        <div v-else class="font-caption font-weight-semibold">
                          Not Eligible for CLR
                        </div>
                      </div>
                    </div>
                    {% comment %} Delete Icon {% endcomment %}
                    <div class="col-1">
                      <i class="fas fa-trash-alt" style="cursor: pointer; opacity: 40%"
                        @click="removeGrantFromCart(grant.grant_id)"></i>

                    </div>
                  </div>
                  <div class="row font-smaller-3 mt-3"  style="margin-left:0.5rem">
                    <div class="comment-option col-auto" @click="addComment(index)">
                      <input :id="`comment-${index}-blank`" type="radio" class="radio-input" :name="`comment-${index}`"
                             :checked="grant.grant_comments === ''"
                      >
                      <label :for="`comment-${index}-blank`" class="radio-label">+ Add comment to owner</label>
                    </div>
                    <div class="comment-option col-auto" @click="addComment(index, 'üôå Great Job')">
                      <input :id="`comment-${index}-job`" type="radio" class="radio-input" :name="`comment-${index}`"
                             :checked="grant.grant_comments === 'üôå Great Job'"
                      >
                      <label :for="`comment-${index}-job`" class="radio-label">üôå Great Job</label>
                    </div>
                    <div class="comment-option col-auto" @click="addComment(index, 'üëç i appreciate you')">
                      <input :id="`comment-${index}-appreciate`" type="radio" class="radio-input" :name="`comment-${index}`"
                             :checked="grant.grant_comments === 'üëç i appreciate you'"
                      >
                      <label :for="`comment-${index}-appreciate`" class="radio-label">üëç i appreciate you</label>
                    </div>
                    <div class="comment-option col-auto" @click="addComment(index, 'üí™ keep up the great work')">
                      <input :id="`comment-${index}-work`" type="radio" class="radio-input" :name="`comment-${index}`"
                             :checked="grant.grant_comments === 'üí™ keep up the great work'"
                      >
                      <label :for="`comment-${index}-work`" class="radio-label">üí™ keep up the great work</label>
                    </div>
                    <div class="comment-option col-auto" @click="addComment(index, 'üòç love the mission of your project')">
                      <input :id="`comment-${index}-love`" type="radio" class="radio-input" :name="`comment-${index}`"
                             :checked="grant.grant_comments === 'üòç love the mission of your project'"
                      >
                      <label :for="`comment-${index}-love`" class="radio-label">üòç love the mission of your project</label>
                    </div>
                  </div>
                  <input v-if="grant.grant_comments !== undefined" style="margin-top:0.5rem; margin-left:0.5rem"
                    class="form-control" v-model="grant.grant_comments" type="textarea" placeholder="Enter message">
                </div>
              </div>

              {% comment %} Cart total {% endcomment %}
              <div class="flex-container font-bigger-1 text-left grant-header-row black" style="font-weight: bold">
                <div style="width: 25%">
                  <div class="flex-container" style="justify-content: start">
                    TOTAL
                  </div>
                </div>
                <div style="width: 75%">
                  <div class="flex-container" style="justify-content: start">
                    [[donationsTotalString]]
                  </div>
                </div>
              </div>

              {% comment %} Hide wallet option {% endcomment %}
              <div class="flex-container text-left grant-header-row black">
                <div style="width: 100%">
                  <div class="flex-container" style="justify-content: start">
                    <input v-model="hideWalletAddress" type="checkbox" id="hide_wallet_address"
                      style="margin-right:1rem">
                    <span class="font-smaller-1 darker-gray"
                      for="hide_wallet_address">{% trans "Hide my wallet address" %}</span>
                    <span id="hide_wallet_address_help" class="font-smaller-2 medium-dark-gray"
                      style="margin-left: 0.5rem;">
                      {% trans "If this option is chosen, your wallet address will be hidden" %}
                    </span>
                  </div>
                </div>
              </div>

              {% comment %} Contribution to Gitcoin notice / adjustment {% endcomment %}
              <div class="flex-container text-left grant-header-row black">
                <div style="width: 100%">
                  <div class="flex-container" style="justify-content: start">
                    <div id="gitcoin-grant-section" class="form__group-horizontal mt-2 mb-2">
                      <div class="row">
                        <div class="col-12 mb-3">
                          <p class="font-body">
                            {% trans "By using this service, you‚Äôll also be contributing" %}
                            <span class="gitcoin-grant-percent">[[gitcoinFactorRaw]]%</span>
                            {% trans "of your contribution to the" %} <a
                              href="https://gitcoin.co/grants/86/gitcoin-sustainability-fund" target="_blank">Gitcoin
                              Grants Round 7+ Development Fund <i class="fas fa-external-link-alt"></i></a>.
                            <div class="font-smaller-1 hyperlink" @click="adjustGitcoinFactor=true">
                              Adjust &gt;&gt;
                            </div>
                          </p>
                        </div>
                        <div v-if="adjustGitcoinFactor" class="col-12 col-xl-8 text-center text-xl-left fee-slider">
                          {% include './heart.html' %}
                          <div class="d-xl-inline ml-xl-3 mt-4 mt-xl-0">
                            <div class="badge badge-active font-title font-weight-normal"
                              :class="{inactive: ![5,10,15].includes(gitcoinFactorRaw), 'badge-inactive': gitcoinFactorRaw != 5}"
                              @click="gitcoinFactorRaw=5">
                              5%</div>
                            <div class="badge badge-active font-title font-weight-normal ml-xl-2"
                              :class="{inactive: ![5,10,15].includes(gitcoinFactorRaw), 'badge-inactive': gitcoinFactorRaw != 10}"
                              @click="gitcoinFactorRaw=10">
                              10%</div>
                            <div class="badge badge-active font-title font-weight-normal ml-xl-2"
                              :class="{inactive: ![5,10,15].includes(gitcoinFactorRaw), 'badge-inactive': gitcoinFactorRaw != 15}"
                              @click="gitcoinFactorRaw=15">
                              15%</div>
                          </div>
                        </div>
                        <div v-if="adjustGitcoinFactor"
                          class="col-12 col-xl-4 mt-4 my-xl-auto px-xl-0 font-weight-semibold text-center text-xl-left fee-slider-summary">
                          <div class="text-center custom d-inline-block">
                            <input type="number" min="0" max="99" step="any" id="gitcoin-grant-input-amount"
                              name="gitcoin-grant-input-amount" class="form__input text-center"
                              :class="{inactive: [5,10,15].includes(gitcoinFactorRaw)}" value="5"
                              v-model="gitcoinFactorRaw">
                            <p class="mb-0 text-center helper-text mx-0 font-caption">custom %</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {% comment %} Summary {% endcomment %}
              <div class="flex-container font-bigger-1 text-left grant-header-row black"
                style="font-weight: bold; margin-top: 1rem;">
                <div style="width: 100%">
                  <div class="flex-container" style="justify-content: start">
                    SUMMARY
                  </div>
                </div>
              </div>

              <div class="flex-container text-left cart-section black">
                <div style="width: 100%">
                  <div class="flex-container" style="justify-content: start">
                    <ul>
                      <li>
                        You are contributing <span style="font-weight: bold">[[donationsToGrantsString]]</span>
                      </li>
                      <li>
                        You are additionally contributing
                        <span style="font-weight: bold">[[donationsToGitcoinString]]</span>
                        to the Gitcoin Mainainter Grant
                      </li>
                      <li>
                        Note: The exact checkout flow will depend on whether you use standard checkout or zkSync.
                        <a href="https://github.com/gitcoinco/web/blob/master/docs/GRANTS.md" target="_blank">
                          Read how this works</a>.
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="flex-container" style="margin-top: 3rem;">
                <div style="width: 100%">
                  <div class="flex-container" style="justify-content: start">
                    <button v-if="!isLoggedIn" class="btn btn-gc-blue button--full shadow-none py-3"
                      id='js-fundGrants-button' @click="loginWithGitHub">
                      <i class="fab fa-github"></i>
                      Login with GitHub to Continue
                    </button>
                    <div v-else>
                      <div class="mb-1">
                        <div v-if="zkSyncUnsupportedTokens.length > 0">
                          zkSync checkout not supported due to [[ zkSyncUnsupportedTokens.join(', ') ]]
                        </div>
                        <div v-else-if="zkSyncDonationInputsGasLimit === '10000000'">
                          zkSync checkout not supported
                        </div>
                        <div v-else>
                          Save
                          <span class="font-weight-bold text-highlight-green">~[[ checkoutRecommendation.savingsInPercent ]]%</span>
                          on gas costs with [[ checkoutRecommendation.name ]]
                        </div>
                      </div>
                      <div class="row align-items-center justify-content-between">
                        <div class="col-auto">
                          <button class="btn btn-gc-blue button--full shadow-none py-3 mt-1" id='js-zkSyncfundGrants-button' @click="startZkSyncCheckoutProcess">
                            Checkout with zkSync
                          </button>
                          </div>
                        <div class="col-auto">
                          <button class="btn btn-outline-gc-blue shadow-none py-3 mt-1" id='js-fundGrants-button' @click="checkout">
                            Standard Checkout
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            {% comment %}
              SMS Verification Modal
              TODO: Much of this code is repeated in the Trust Bonus tab, specifically as a standalone component in
              profile-trust.js. After Grants Round 7, this should be refactored to use a shared component between the
              cart and the Trust Bonus tab.
            {% endcomment %}
            <b-modal id="sms-modal" @hide="dismissVerification()" :visible="showValidation" center hide-header hide-footer>
              <template v-slot:default="{ hide }">
                <div class="mx-5 mt-5 mb-4 text-center" v-if="validationStep == 'intro'">
                  <div class="mb-3">
                    <h1 class="font-bigger-4 font-weight-bold">Verify your phone number</h1>
                  </div>
                  <BR>
                  <p class="mb-4 font-subheader text-left">We'd like to verify your phone number to get your contribution matched. Phone number verification is optional.</p>
                  <BR>
                  <p class="mb-4 font-subheader text-left">Verifying increases your trust level and impact of your contributions. You can still contribute to grants without
                  verifying your phone number, but your contribution impact will be reduced.</p>
                  <BR>
                  <p class="mb-4 font-subheader text-left">Gitcoin does NOT store your phone number.</p>
                  <BR>
                  <p class="mb-4 font-subheader text-left">read more about <a target="_blank" rel="noopener noreferrer" class="gc-text-blue font-smaller-1"
                    href="https://twitter.com/owocki/status/1271088915982675974">why we are asking for your phone number</a> or how Gitcoin <a target="_blank" rel="noopener noreferrer" class="gc-text-blue font-smaller-1"
                      href="https://twitter.com/owocki/status/1271088915982675974">preserves your privacy.</a></p>
                  <b-button @click="validationStep='requestVerification'" class="btn-gc-blue mb-2" size="lg">Verify
                   Phone Number</b-button>
                  <div class="mb-1 font-subheader text-center">
                    <a id="verify_offline" href="#">
                    <br>
                    Verify Offline or</a>  <a href="#" @click="dismissVerification()" variant="link">Skip</a>
                    <div id='verify_offline_target' style="display:none">
                      <strong>Verify Offline</strong>
                      <BR>
                      <a href="mailto:kyc@gitcoin.co">Email Gitcoin</a> or <a href="https://keybase.io/gitcoin_verify">Message Gitcoin on Keybase</a>, and we will verify your information within 1-2 business days.
                      <br>
                      IMPORTANT: Be sure to include (1) your gitcoin username (2) proof of ownership of a SMS number.
                    </div>
                  </div>
                </div>
                <div class="mx-5 my-5 text-center" v-if="validationStep == 'requestVerification'">
                  <div class="mb-3">
                    <h1 class="font-bigger-4 font-weight-bold">Verify your phone number</h1>
                  </div>
                  <p class="mb-5 font-subheader">We will send you a verification code.</p>
                  <vue-tel-input ref="tel-input" :validCharactersOnly="true" @validate="isValidNumber" v-model="phone"
                    :enabledCountryCode="true" :autofocus="true" :required="true" mode="international"
                    inputClasses="form-control" placeholder="+1 8827378273"
                    :inputOptions="{showDialCode: true}"
                  ></vue-tel-input>
                  <div v-if="timeInterval > timePassed">
                    <span class="label-warning">Wait [[ timeInterval - timePassed ]] second before request another
                      code</span>
                  </div>
                  <div v-if="errorMessage">
                    <span class="label-warning">[[ errorMessage ]]</span>
                  </div>
                  <b-button @click="requestVerification()" class="btn-gc-blue mt-5 mb-2" size="lg">Send verification
                    code</b-button>
                  <br>
                  <b-button @click="hide()" variant="link">Cancel</b-button>
                </div>
                <div class="mx-5 my-5 text-center" v-if="validationStep == 'verifyNumber'">
                  <div class="mb-3">
                    <h1 class="font-bigger-4 font-weight-bold">Verify your phone number</h1>
                  </div>
                  <p class="mb-5 font-subheader">Enter the verification code sent to your number.</p>

                  <input class="form-control" type="number" required v-model="code">
                  <div v-if="timeInterval > timePassed">
                    <span class="label-warning">Wait [[ timeInterval - timePassed ]] second before request another
                      code</span>
                  </div>
                  <div v-if="errorMessage">
                    <span class="label-warning">[[ errorMessage ]]</span>
                  </div>
                  <b-button @click="validateCode()" class="btn-gc-blue mt-5" size="lg">Submit</b-button>
                  <br>
                  <b-button @click="startVerification()" variant="link">Change number</b-button>
                  <b-button @click="resendCode()" variant="link">Resend Code</b-button>
                  {% if EMAIL_ACCOUNT_VALIDATION %}
                    <b-button @click="resendCode('email')" variant="link" v-if="display_email_option">Send email</b-button>
                  {% endif %}
                </div>
              </template>
            </b-modal>

          {% comment %} Create Collection Modal {% endcomment %}
            <b-modal id="createCollection" @hide="showCreateCollection = false" :visible="showCreateCollection" center hide-header hide-footer>
              <template v-slot:modal-header="{ close }">
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                  @click="showCreateCollection = false"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </template>
              <template>
                <div class="mx-5 my-5 ">
                  <div class="mb-3 text-center">
                    <h1 class="mb-5 font-bigger-4 font-weight-bold">Save Cart as Collection</h1>
                  </div>
                  <div class="mb-3">
                    <p class="font-subheader">Collection Name.</p>
                    <b-form-input v-model="collectionTitle" placeholder="What would your collection be called?"></b-form-input>
                  </div>
                  <div class="mb-2">
                    <p class="font-subheader">Description (Optional)</p>
                    <b-form-textarea rows="3" max-rows="6" :state=" collectionDescription.length == 0 ? null : collectionDescription.length < 140" v-model="collectionDescription" placeholder="Short description about your collection"></b-form-textarea>
                    <p class="text-right">[[ collectionDescription.length ]]/140</p>
                  </div>

                  <div class="mb-3" v v-if="collections.length">
                    <h2 class="middle-line mb-3"><span class="text-muted font-body">or</span></h2>
                    <p class="font-subheader mt-3 mb-0">Save to existing collection</p>
                    <b-form-select v-model="selectedCollection" text-field="title" value-field="id" :options="collections" size="md" class="mt-3"></b-form-select>
                  </div>

                  <b-button @click="createCollection()" class="btn-gc-blue mt-2 mb-2" size="lg" :disabled="!isValidCollection">Save Collection</b-button>
                  <br>
                </div>
              </template>
            </b-modal>


            {% comment %} ========================================================= {% endcomment %}
            {% comment %} ================== START ZKSYNC MODAL =================== {% endcomment %}
            {% comment %} ========================================================= {% endcomment %}

            <b-modal id="zksync-modal" :visible="showZkSyncModal" @hide="showZkSyncModal = false"
              class="modal-dialog modal-lg" header-border-variant="transparent"
              center hide-footer no-close-on-backdrop no-close-on-esc hide-header-close
            >
              <template v-slot:modal-header="{ close }">
                <button
                  type="button"
                  class="close"
                  data-dismiss="modal"
                  aria-label="Close"
                  @click="close()"
                >
                  <span aria-hidden="true">&times;</span>
                </button>
              </template>
              <template v-if="isZkSyncModalLoading" v-slot:default="{ hide }">
                <div v-if="isZkSyncDown" class="p-2" style="background-color: #FFF6CF; width: 100%;">
                  The zkSync servers are currently having some issues. If you are stuck on this
                  loading screen, try refreshing the page. If that does not resolve the issue,
                  you may want to proceed with Standard Checkout or try again later.
                </div>
                <div class="my-5 py-5">
                  <loading-screen></loading-screen>
                  <div class="text-center my-5">Loading...</div>
                </div>
              </template>
              <template v-else v-slot:default="{ hide }">
                <div class="mx-2 mb-4 text-center">
                  {% comment %} Header {% endcomment %}
                  <div class="mb-3">
                    <img src="{% static 'v2/images/grants/zksync.svg' %}" alt="zkSync Logo" width="150">
                    {% comment %} Header {% endcomment %}
                    <div v-if="!zkSyncWasInterrupted">
                      <h1 class="font-bigger-4 font-weight-bold mt-2">Pay with zkSync</h1>
                    </div>
                    <div v-else>
                      <h1 class="font-bigger-4 font-weight-bold mt-2">
                        <i class="fas fa-exclamation-triangle" style="color: #ECC94B"></i>
                        Complete zkSync Checkout
                      </h1>
                    </div>
                    {% comment %} Body {% endcomment %}
                    <div v-if="zkSyncCheckoutStep2Status !== 'not-started'"
                      class="mt-4 p-2 text-left font-smaller-1" style="background-color: #FFF6CF; width: 100%;"
                    >
                      {% comment %} Status updates for user {% endcomment %}
                      <div class="font-weight-bold">PLEASE DO NOT CLOSE THIS WINDOW!</div>
                      <div>
                        <div>
                          <span v-if="hasSufficientZkSyncBalance">
                            Estimated processing time: <span class="font-weight-bold">&lt; 1m</span>.&nbsp;
                          </span>
                          <span v-else>
                            Estimated processing time: <span class="font-weight-bold">2m&ndash;4m</span>.&nbsp;
                          </span>
                          <span v-if="zkSyncBlockExplorerUrl">
                            <a :href="zkSyncBlockExplorerUrl" target="_blank">
                              View transaction<span v-if="hasSufficientZkSyncBalance">s</span>
                              &nbsp;<i class="fas fa-external-link-alt"></i>
                            </a>
                          </span>
                        </div>
                        <div v-if="zkSyncBlockExplorerUrl && zkSyncCheckoutStep3Status !== 'not-started'">
                          <div v-if="zkSyncCheckoutFlowStep === 0">
                            Confirmations received: [[currentConfirmationNumber]] of [[numberOfConfirmationsNeeded]]
                          </div>
                          <div v-else-if="zkSyncCheckoutFlowStep === 1">
                            {% comment %} Wait for state change commitment {% endcomment %}
                            Waiting for confirmation that deposit was received by zkSync...
                          </div>
                          <div v-else-if="zkSyncCheckoutFlowStep === 2">
                            {% comment %} Get signatures for each transfer {% endcomment %}
                            Preparing transfer [[currentTxNumber]] of [[donationInputs.length]]
                          </div>
                          <div v-else-if="zkSyncCheckoutFlowStep === 3">
                            {% comment %} Dispatch transfers to the zkSync network {% endcomment %}
                            Sending transfer [[currentTxNumber]] of [[donationInputs.length]]
                          </div>
                          <div v-else-if="zkSyncCheckoutFlowStep === 4">
                            {% comment %} Transfer remaining balances to user's main wallet {% endcomment %}
                            Finalizing contributions...
                          </div>
                          <div v-else-if="zkSyncCheckoutFlowStep === 5">
                            Checkout complete!
                          </div>
                        </div>
                      </div>
                    </div>
                    <p v-if="!zkSyncWasInterrupted" class="mt-4 text-left">
                      <span v-if="zkSyncCheckoutStep2Status === 'not-started'">
                        zkSync is powered by zkRollup with a universal setup &mdash; an L2
                        scaling solution. Save gas fees and get faster confirmations.
                        <a href="https://zksync.io/" target="_blank">Learn more</a>.
                        <br><br>
                      </span>
                      <span v-if="hasSufficientZkSyncBalance">
                        To pay with zkSync, you will have to sign
                        <span v-if="zkSyncCheckoutStep2Status !== 'complete'">up to</span>
                        [[maxPossibleSignatures]] messages with your Web3 wallet.
                      </span>
                      <span v-else>
                        To pay with zkSync, you will have to sign one message and send up to
                        [[maxPossibleTransactions]] transactions with your Web3 wallet.
                      </span>
                    </p>
                    <p v-else class="mt-4 text-left">
                      You started checking out with zkSync but never completed the process.
                      You must complete this checkout before proceeding with any other checkouts.
                      Please follow the prompts below to complete the process.
                    </p>
                    </div>
                  </div>
                  {% comment %} Advanced settings {% endcomment %}
                  <div v-if="!zkSyncWasInterrupted && !hasSufficientZkSyncBalance" class="mb-3">
                    <div class="row justify-content-end font-smaller-1 font-weight-semibold text-highlight-dark-blue">
                      <div @click="showAdvancedSettings = !showAdvancedSettings" class="col-auto" style="cursor: pointer;">
                        Advanced settings <i class="ml-1 fas fa-cog"></i>
                      </div>
                    </div>
                    <div v-if="showAdvancedSettings" class="p-3 text-left" style="background-color: #F1F1F1; width: 100%;">
                      <div>
                        Save 98% on future checkouts!
                      </div>
                      <div class="mt-1 font-smaller-1 text-medium-dark-grey">
                        When you have enough funds on zkSync there is no need for an L1 transaction.
                        The funds can also be accessed via
                        <a href="https://wallet.zksync.io/" target="_blank">https://wallet.zksync.io/</a>
                        for use outside of Gitcoin.
                      </div>
                      <div class="row justify-content-start align-items-center mt-3">
                        <div class="col-4 font-smaller-1 text-medium-dark-grey">
                          Current deposit
                        </div>
                        <div class="col-1">
                          &nbsp;
                        </div>
                        <div class="col-7 font-smaller-1 text-medium-dark-grey">
                          Additional deposit
                        </div>
                      </div>
                      <div>
                        {% comment %} v-for each token in cart {% endcomment %}
                        <div v-for="(additionalDeposit, index) in zkSyncAdditionalDeposits"
                          class="row justify-content-start align-items-center mt-1"
                        >
                          <div class="col-4">
                            [[ donationsTotal[additionalDeposit.tokenSymbol] ]] [[ additionalDeposit.tokenSymbol ]]
                          </div>
                          <div class="col-1">
                            +
                          </div>
                          <div class="col-7">
                            <div class="row justify-content-start align-items-center">
                              {% comment %} User must input amount before {% endcomment %}
                              <input v-model.number="additionalDeposit.amount" class="col-5 form-control"
                                style="margin-left:0.5rem" min="0" step="any" type="number"
                                :disabled="zkSyncCheckoutStep2Status !== 'not-started'"
                              >
                              <div class="col-5">[[ additionalDeposit.tokenSymbol ]]</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% comment %} Body {% endcomment %}
                  <div>
                    {% comment %} Step 1 {% endcomment %}
                    <div class="row align-items-center justify-content-between mb-4 text-left">
                      <div class="col-8">
                        <div class="font-weight-bold">
                          Step 1
                        </div>
                        <div>
                          Sign in to zkSync via Gitcoin
                        </div>
                      </div>
                      <div class="col-4">
                        <button v-if="zkSyncCheckoutStep1Status === 'not-started'"
                          class="btn btn-gc-blue button--full shadow-none" @click="zkSyncLoginGitcoinFlow"
                        >
                          Sign in
                        </button>
                        <div v-else-if="zkSyncCheckoutStep1Status === 'pending'">
                          <span class="text-medium-dark-grey">
                            <i class="fas fa-spinner fa-spin"></i>
                            Processing
                          </span>
                        </div>
                        <div v-else-if="zkSyncCheckoutStep1Status === 'complete'">
                          <span class="text-highlight-green">
                            <i class="fas fa-check"></i>
                            Completed
                          </span>
                        </div>
                      </div>
                    </div>
                    {% comment %} Step 2 {% endcomment %}
                    <div class="row align-items-center justify-content-between mb-4 text-left">
                      <div class="col-8">
                        <div class="font-weight-bold">
                          Step 2
                        </div>
                        <div>
                          <span v-if="hasSufficientZkSyncBalance">Sign in to zkSync directly</span>
                          <span v-else>ERC20 token approvals</span>
                        </div>
                      </div>
                      <div class="col-4">
                        <button v-if="zkSyncCheckoutStep2Status === 'not-started'"
                          :disabled="zkSyncCheckoutStep1Status !== 'complete'" class="btn btn-gc-blue button--full shadow-none"
                          @click="zkSyncBeginStep2"
                        >
                          <span v-if="hasSufficientZkSyncBalance">Sign in</span>
                          <span v-else>Approve</span>
                        </button>
                        <div v-else-if="zkSyncCheckoutStep2Status === 'not-applicable'">
                          <span class="text-highlight-green">
                            <i class="fas fa-check"></i>
                            Not required
                          </span>
                        </div>
                        <div v-else-if="zkSyncCheckoutStep2Status === 'pending'">
                          <span class="text-medium-dark-grey">
                            <i class="fas fa-spinner fa-spin"></i>
                            Processing
                          </span>
                        </div>
                        <div v-else-if="zkSyncCheckoutStep2Status === 'complete'">
                          <span class="text-highlight-green">
                            <i class="fas fa-check"></i>
                            Completed
                          </span>
                        </div>
                      </div>
                    </div>
                    {% comment %} Step 3 {% endcomment %}
                    <div class="row align-items-center justify-content-between mb-2 text-left">
                      <div class="col-8">
                        <div class="font-weight-bold">
                          Step 3
                        </div>
                        <div>
                          Confirm donation transaction
                        </div>
                      </div>
                      <div class="col-4">
                        <button v-if="zkSyncCheckoutStep3Status === 'not-started' && !zkSyncWasInterrupted"
                          :disabled="zkSyncCheckoutStep2Status === 'not-started'"
                          class="btn btn-gc-blue button--full shadow-none" @click="zkSyncBeginStep3"
                        >
                          Confirm
                        </button>
                        <button v-else-if="zkSyncCheckoutStep3Status === 'not-started' && zkSyncWasInterrupted"
                          :disabled="zkSyncCheckoutStep2Status === 'not-started'"
                          class="btn btn-gc-blue button--full shadow-none" @click="resumeZkSyncDonation"
                        >
                          Confirm
                        </button>
                        <div v-else-if="zkSyncCheckoutStep3Status === 'pending'">
                          <span class="text-medium-dark-grey">
                            <i class="fas fa-spinner fa-spin"></i>
                            Processing
                          </span>
                        </div>
                        <div v-else-if="zkSyncCheckoutStep3Status === 'complete'">
                          <span class="text-highlight-green">
                            <i class="fas fa-check"></i>
                            Completed
                          </span>
                        </div>
                      </div>
                    </div>
                    {% comment %} Fees {% endcomment %}
                    <div v-if="!hasSufficientZkSyncBalance" class="row align-items-center justify-content-between mb-4 text-left font-smaller-2">
                      {% comment %}
                      If user has sufficient zkSync balance, fees are shown when signing the message.
                      If user does not have sufficient zkSync balance, the fees are hidden so 
                      in that case we display them here.
                      {% endcomment %}
                      <div class="col-12">
                        Amount in cart: [[ donationsTotalString ]]
                      </div>
                      <div class="col-12">
                        Estimated fees: [[ zkSyncFeesString ]]
                      </div>
                      <div class="col-12">
                        <a href="https://github.com/gitcoinco/web/blob/master/docs/GRANTS.md" target="_blank">
                          Read more about fees and the zkSync checkout process.
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
            </b-modal>

            {% comment %} ========================================================= {% endcomment %}
            {% comment %} =================== END ZKSYNC MODAL ==================== {% endcomment %}
            {% comment %} ========================================================= {% endcomment %}
          </div>
        </grants-cart>
      </div>
    </div>


    <script type="text/x-template" id="select2-template">
      <select>
        <slot></slot>
      </select>
    </script>

    {% include 'shared/current_profile.html' %}
    {% include 'shared/bottom_notification.html' %}
    {% include 'shared/analytics.html' %}
    {% include 'shared/footer_scripts.html' with ignore_inject_web3=1 %}
    {% include 'shared/footer.html' %}
    {% include 'grants/shared/shared_scripts.html' %}

    {% comment %} ================================================================= {% endcomment %}
    {% comment %} ===================== START ZKSYNC SCRIPTS ====================== {% endcomment %}
    {% comment %} ================================================================= {% endcomment %}

    <script type="text/javascript" src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/zksync@0.6.4/dist/main.js"></script>
    <script type="text/javascript">
    (async () => {
        // Loads and compiles wasm library
        await zksync.crypto.loadZkSyncCrypto();
        console.log('zkSync library is ready');
        // Now we are ready to use zkSync with ethers, both are attached to the window
    })();
    </script>

    {% comment %} ================================================================= {% endcomment %}
    {% comment %} ====================== END ZKSYNC SCRIPTS ======================= {% endcomment %}
    {% comment %} ================================================================= {% endcomment %}

    <script src="{% static "v2/js/lib/vue-tel-input.min.js" %}"></script>
    <script src="{% static "v2/js/lib/bootstrap-vue.min.js" %}"></script>
    <script>
      // MOVE VERIFIED STATUS INTO JS
      document.verified = {{ verified | yesno:"true,false" }};
      document.authenticated = {{ authenticated | yesno:"true,false" }};
      document.brightid_uuid = "{{ brightid_uuid }}";
    </script>
    <script src="{% static "v2/js/cart.js" %}"></script>
  </body>

  {% include 'shared/activity_scripts.html' %}
  <link rel="stylesheet" href="{% static "v2/css/activity_stream.css" %}">
  <script src="{% static "v2/js/status.js" %}"></script>
  <script src="{% static "v2/js/pages/tabs.js" %}"></script>
  <script src="{% static "v2/js/grants/index.js" %}"></script>
  <script src="{% static "v2/js/abi.js" %}"></script>
  <script src="{% static "v2/js/pages/shared_bounty_mutation_estimate_gas.js" %}"></script>
  <script src="{% static "v2/js/lib/ipfs-api.js" %}"></script>
  <script src="{% static "v2/js/ipfs.js" %}"></script>
  <script>
    $('[data-toggle="tooltip"]').bootstrapTooltip();

  </script>
  <script src="{% static "v2/js/user-search.js" %}"></script>
  <script src="{% static "v2/js/grants/shared.js" %}"></script>
  <script src="{% static "v2/js/grants/detail.js" %}"></script>
  <script src="{% static "v2/js/waiting_room_entertainment.js" %}"></script>
  <script>
    $('#wallet-address').attr(
      'href',
      get_etherscan_url(
        $('#wallet-address').text().trim(),
        '{{ grant.network }}',
        'address'
      )
    );

  </script>

  </html>
